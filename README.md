# FlaatSDK

*(the SDK is currently in active development, so the interface and instructions for installation in this README may not always be up-to-date with latest changes in code or configuration)*

## About

FlaatSDK for iOS provides APIs which enable easy adoption of [TCN Protocol](https://github.com/TCNCoalition/TCN) for privacy-preserving contact tracing by iOS applications.

SDK features include:
* monitoring for broadcasted TCNs (Temporary Contact Numbers) and saving them to persistent store on device
* broadcasting TCNs which are frequently rotated to disable tracking of users
* periodic downloading of new reports from ***Flaat*** servers and checking user's risk status by matching reports with TCNs received from other devices
* uploading anonymous infection reports to ***Flaat*** servers which will be received by other users and analyzed locally on each device

## Example

To run the example `FlaatDemo` project, clone the repo, and run `pod install` from the Example directory first.

## Installation

Importing with Cocoapods supported, however the framework hasn't been published to Cocoapods registry yet.

To install FlaatSDK:

1. Add the following line to your Podfile:

```ruby
pod 'FlaatSDK', :git => 'git@github.com:EQWorks/flaat-sdk-ios.git', :branch => 'master'
```

2. Add `TCNClient` dependency. FlaatSDK for iOS depends on [TCNClient library](https://github.com/TCNCoalition/tcn-client-ios) for iOS which hasn't been published to Cocoapods (as of April 2020) yet, so it needs to be imported by the application. Add the following line to your app's Podfile:

```ruby
pod 'TCNClient', :git => 'https://github.com/TCNCoalition/tcn-client-ios.git', :branch => 'master'
```

3. Run `pod install`. Open your app's `.xcworkspace` file generated by Cocoapods.

4. Go to *Signing & Capabilities* tab of your application target, add **Background Modes** capability and enable both checkmarks:
  * Uses Bluetooth LE accessories
  * Acts as a Bluetooth LE accessory

## Usage

Import FlaatSDK module:

```swift
import FlaatSDK
```


### Launch BLE Moniroting

You will need `API_KEY` which is issued for each registered application and is verified by ***Flaat*** backend every time when the framework is contacting server.

It is recommended to start Bluetooth monitoring right on the application launch. In your app's delegate `application(_:didFinishLaunchingWithOptions:)` method add the following code to launch FlaatSDK monitoring:

```swift
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    	// ...

    	FlaatService.launch(apiKey: "<your app's API_KEY>")
    }
```

### Submit Infection Report

Before uploading a report you will need a validation pin which should be provided to user by health authority.

```swift
    FlaatService.uploadReport(validationPin: "<user's unique validation pin>") { [weak self] (error) in
        if let error = error {
            NSLog("Could not upload report: \(error)")
            // ...
        } else {
            NSLog("Report upload succeeded")
            // ...
        }
    }
```

## License

FlaatSDK is distributed under MIT License.
